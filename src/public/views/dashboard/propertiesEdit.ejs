<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Edit Property - <%= config.Business.Name %>
    </title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
</head>

<body class="font-sans bg-gray-100">
    <div class="flex min-h-screen relative">
        <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden md:hidden" aria-hidden="true">
        </div>
        <%- include('../partials/aside') %>
            <div class="flex-1 flex flex-col transition-all duration-300 ease-in-out md:ml-64 w-full">
                <%- include('../partials/header') %>
                    <main class="flex-1 p-4 sm:p-6 lg:p-8 overflow-y-auto">
                        <h1 class="text-xl sm:text-2xl md:text-3xl font-bold text-center mb-6 sm:mb-8">Edit Property
                        </h1>
                        <form id="editPropertyForm" class="space-y-4"
                            data-existing-images='<%= JSON.stringify([property.featuredImage ? Buffer.from(property.featuredImage).toString("base64") : null, ...(property.images || []).map(img => Buffer.from(img).toString("base64"))].filter(Boolean)) %>'
                            data-featured-image-index="0">
                            <input type="hidden" id="propertyId" name="id" value="<%= property.id %>" />

                            <div>
                                <label for="name" class="block text-sm font-medium">Name</label>
                                <input type="text" id="name" name="name" class="w-full border rounded-lg p-2"
                                    value="<%= property.name %>" required />
                            </div>

                            <div>
                                <label for="description" class="block text-sm font-medium">Description</label>
                                <textarea id="description" name="description" class="w-full border rounded-lg p-2"
                                    rows="4" required><%= property.description %></textarea>
                            </div>

                            <div>
                                <label for="price" class="block text-sm font-medium">Price</label>
                                <input type="number" id="price" name="price" class="w-full border rounded-lg p-2"
                                    value="<%= property.price %>" required />
                            </div>

                            <div>
                                <label for="currencySymbol" class="block text-sm font-medium">Currency Symbol</label>
                                <input type="text" id="currencySymbol" name="currencySymbol"
                                    class="w-full border rounded-lg p-2" value="<%= property.currencySymbol %>"
                                    maxlength="3" required />
                            </div>

                            <div>
                                <label for="address" class="block text-sm font-medium">Address</label>
                                <input type="text" id="address" name="address" class="w-full border rounded-lg p-2"
                                    value="<%= property.address %>" />
                            </div>

                            <div>
                                <label for="hours" class="block text-sm font-medium">Hour(s)</label>
                                <input type="number" id="hours" name="hours" class="w-full border rounded-lg p-2"
                                    min="1" value="<%= property.hours %>" required />
                            </div>

                            <div>
                                <label for="showcase" class="block text-sm font-medium">Showcase</label>
                                <select id="showcase" name="showcase" class="w-full border rounded-lg p-2">
                                    <option value="true" <%=property.showcase ? 'selected' : '' %>>Yes</option>
                                    <option value="false" <%=!property.showcase ? 'selected' : '' %>>No</option>
                                </select>
                            </div>

                            <div>
                                <label for="images" class="block text-sm font-medium">Upload Images</label>
                                <input type="file" id="images" name="images" class="w-full border rounded-lg p-2"
                                    multiple accept="image/*" />
                            </div>

                            <div id="image-preview" class="flex flex-wrap gap-4 mt-4">
                                <% var allImages=[]; if (property.featuredImage) {
                                    allImages.push(Buffer.from(property.featuredImage).toString('base64')); } if
                                    (property.images && property.images.length) { for (var i=0; i <
                                    property.images.length; i++) {
                                    allImages.push(Buffer.from(property.images[i]).toString('base64')); } } %>
                                    <% if (allImages.length> 0) { %>
                                        <% for (var idx=0; idx < allImages.length; idx++) { %>
                                            <div class="relative w-32 h-32 border rounded-lg overflow-hidden">
                                                <img src="data:image/jpeg;base64,<%= allImages[idx] %>"
                                                    alt="Image <%= idx + 1 %>"
                                                    class="w-full h-full object-cover <%= idx === 0 ? 'border-4 border-blue-500' : '' %>" />
                                                <div
                                                    class="absolute top-2 right-2 bg-white shadow rounded-lg hidden z-10">
                                                    <button type="button"
                                                        class="block px-2 py-1 text-sm text-red-500 hover:bg-gray-100"
                                                        data-action="delete" data-index="<%= idx %>">Delete</button>
                                                    <button type="button"
                                                        class="block px-2 py-1 text-sm text-blue-500 hover:bg-gray-100"
                                                        data-action="feature" data-index="<%= idx %>">Featured</button>
                                                </div>
                                                <button type="button"
                                                    class="absolute top-2 right-2 bg-gray-800 text-white rounded-full p-1 z-20 burger-menu">â˜°</button>
                                                <% if (idx===0) { %>
                                                    <span
                                                        class="absolute bottom-2 left-2 bg-blue-500 text-white text-xs px-2 py-1 rounded">Featured</span>
                                                    <% } %>
                                            </div>
                                            <% } %>
                                                <% } else { %>
                                                    <p>No images available</p>
                                                    <% } %>
                            </div>
                            <button type="submit"
                                class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition">Save
                                Changes</button>
                        </form>
                    </main>
            </div>
    </div>

    <script src="/js/properties.js"></script>
    <script src="/js/script.js"></script>
</body>

</html>